<style>
    table, th, td {
        border: 1px solid black;
    }
</style>
<table style="padding: 10px;border: 1px solid black;border-collapse: collapse;" border="1">
    <thead>
    <tr>
        <td colspan="46" style="text-align: center;vertical-align:center;background-color: #cfe3f8; height: 30px;padding: 10px;border: 1px solid black;border-collapse: collapse;">
            نظام مركز معاً لإدارة الاقتراحات والشكاوى- ملحق رقم (1): بيانات الاقتراحات والشكاوى المسجلة على النظام.
        </td>
    </tr>
    <tr>
        <th colspan="12" style="text-align: center;vertical-align:center;background-color: #a9d08e; height: 30px;padding: 10px;border: 1px solid black;border-collapse: collapse;">المعلومات الأساسية:</th>
        <th colspan="23" style="text-align: center;vertical-align:center;background-color: #9bc2e6; height: 30px;padding: 10px;border: 1px solid black;border-collapse: collapse;">تفاصيل الاقتراح/الشكوى: </th>
        <th colspan="4" style="text-align: center;vertical-align:center;background-color: #a9d08e; height: 30px;padding: 10px;border: 1px solid black;border-collapse: collapse;">الردود والمتابعات: </th>
        <th colspan="5" style="text-align: center;vertical-align:center;background-color: #9bc2e6; height: 30px;padding: 10px;border: 1px solid black;border-collapse: collapse;">التغذية الراجعة: </th>
        <th colspan="2" style="text-align: center;vertical-align:center;background-color: #a9d08e; height: 30px;padding: 10px;border: 1px solid black;border-collapse: collapse;">متابعة معالجة الاقتراح/الشكوى في حال عدم رضا مقدمها عن الرد الذي تلقاه </th>


    </tr>
    <tr>
        {{--    المعلومات الأساسية:    --}}
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">الرقم المرجعي</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">الاسم الرباعي</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">رقم الهوية</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">المحافظة</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">المنطقة</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">العنوان</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">رقم التواصل (1)</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">رقم التواصل (2)</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">فئة مقدم الاقتراح/الشكوى</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">اسم المشروع</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">حالة المشروع</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">رقم طلب المشروع</th>

        {{--   تفاصيل الاقتراح/الشكوى:     --}}
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">قناة الاستقبال</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">مكان تواجد الصندوق</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">تاريخ فتح الصندوق</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">رقم اجتماع فتح الصندوق</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">نوع زيارة المتابعة</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">حساب مسجل الاقتراح/الشكوى</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">اسم المستخدم</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">تاريخ تقديم الاقتراح/الشكوى</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">تاريخ تسجيل الاقتراح/الشكوى</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">التصنيف</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">محتوى الاقتراح/ الشكوى</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">فئة الاقتراح/ الشكوى</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">الجهة المختصة بالدراسة والمعالجة</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">الجهة المختصة بالمصادقة على الرد</th>
        <th style="text-align: center;vertical-align:center;background-color: #9bc2e6;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" colspan="7">الحاجة للاستيضاح عن محتوى الاقتراح/الشكوى</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">التصنيف بناءً على الإجراءات المطلوبة</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">طبيعة الإجراءات المطولة المطلوبة للرد</th>

          {{--    الردود والمتابعات:    --}}
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">حالة الرد</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">تفاصيل الرد</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">تاريخ تسجيل الرد</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">الجهة مسؤولة عن تبليغ الرد (موظف اتصال)</th>

        {{--    التغذية الراجعة:    --}}
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">حالة تبليغ  الرد</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">سبب عدم تبيلغ الرد</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">تاريخ تبيلغ الرد</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">التغذية الراجعة</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">سبب عدم الرضا عن الرد</th>

         {{--  متابعة معالجة الاقتراح/الشكوى في حال عدم رضا مقدمها عن الرد الذي تلقاه      --}}
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">الجهة الإدارية المسؤولة عن اعادة معالجة الاقتراح/الشكوى</th>
        <th style="text-align: center;vertical-align:center;background-color: #c6e0b4;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;" rowspan="2">هل الاقتراح/الشكوى بحاجة لإغلاق</th>

    </tr>
    <tr>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;">هل  الاقتراح/الشكوى بحاجة لاستيضاح</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;">هل تم الاستيضاح عن المعلومات المطلوبة</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height: 20px;padding: 10px;border: 1px solid black;border-collapse: collapse;">سبب عدم الاستيضاح</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height:20px;padding: 10px;border: 1px solid black;border-collapse: collapse;">إعادة صياغة محتوى الاقتراح/ الشكوى بناءً على الاستيضاح</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height:20px;padding: 10px;border: 1px solid black;border-collapse: collapse;">فئة الاقتراح/ الشكوى المعدلة بناءً نتائج الاستيضاح</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height:20px;padding: 10px;border: 1px solid black;border-collapse: collapse;">الجهة المختصة بالمعالجة</th>
        <th style="text-align: center;vertical-align:center;background-color: #bdd7ee;height:20px;padding: 10px;border: 1px solid black;border-collapse: collapse;">الجهة المختصة بالمصادقة على الرد</th>
    </tr>
    </thead>
    <tbody>

    @foreach($items as $item)

        <?php
        $process_account="";
        $confirm_account="";

        ?>

        <tr>
            {{--    المعلومات الأساسية:    --}}
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->form_no }}</td>
            @if($item->hide_data == 2)
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{'_'}}</td>
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{'_'}}</td>
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{'_'}}</td>
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{'_'}}</td>
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{'_'}}</td>
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{'_'}}</td>
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{'_'}}</td>
            @else
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">@if($item->first_name){{ $item->first_name .' '.$item->father_name .' '.$item->grandfather_name.' '.$item->last_name }}@else {{ $item->citizen->first_name .' '.$item->citizen->father_name .' '.$item->citizen->grandfather_name.' '.$item->citizen->last_name }} @endif</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->id_number ? $item->id_number : $item->citizen->id_number }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->governorate ? $item->governorate :  $item->citizen->governorate }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->city ? $item->city :  $item->citizen->city }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->street ?  $item->street :  $item->citizen->street }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->mobile ?  $item->mobile :  $item->citizen->mobile }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">

                @if($item->mobile2)
                    {{$item->mobile2}}
                @elseif($item->citizen && $item->citizen->mobile2)
                    {{$item->citizen->mobile2}}
                @else
                    {{'_'}}
                @endif
            </td>
            @endif
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->project_id == 1 ? 'غير مستفيد' : ' مستفيد' }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->binfit}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->project_end_date <= now() ?  'منتهي' : 'مستمر'}}</td>

            <?php if($item->project_id != 1){?>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->project_request ?  $item->project_request : '_' }}</td>
            <?php }else{?>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">_</td>
            <?php }?>


            {{--   تفاصيل الاقتراح/الشكوى:     --}}
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->senmmes ? $item->senmmes : $item->sent_typee->name }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;color: red;">{{$item->box_place ? $item->box_place : '-' }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;color: red;">{{$item->date_open_box ? $item->date_open_box : '-' }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;color: red;">{{$item->number_of_open_box ? $item->number_of_open_box : '-' }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;color: red;">{{$item->type_of_followup_visit ? $item->type_of_followup_visit : '-' }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->account_id }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->employee_name }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->datee }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->created_at }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->ammes }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->content }}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{ $item->nammes }}</td>
            <?php
            $categoryCircles_users1 = $categoryCircles_users2 = $auth_circle_users = array();

            $categoryCircles = \App\CategoryCircles::where('category_id', '=', $item->category_id)->get();

            $userinprojects = \App\AccountProjects::select('rate', 'account_id')->where('project_id', '=', $item->project_id)
                ->pluck('rate', 'account_id')->toArray();

            foreach ($categoryCircles as $categoryCircle) {
                if ($categoryCircle->procedure_type == 2) {
                    array_push($categoryCircles_users1, $categoryCircle->circle_id);
                }

                if ($categoryCircle->procedure_type == 3) {
                    array_push($categoryCircles_users2, $categoryCircle->circle_id);
                }
            }

            $user1 = \App\Circle::find($categoryCircles_users1[0]);
            $user2 = \App\Circle::find($categoryCircles_users2[0]);

            ?>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$user1->name}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$user2->name}}</td>


            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">@if($item->need_clarification == 1){{'نعم'}}@else{{'لا'}}@endif</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">@if($item->have_clarified == 1){{'نعم'}}@else{{'-'}}@endif</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->reason_lack_clarification ? $item->reason_lack_clarification : '-'}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->reformulate_content ? $item->reformulate_content : '-'}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->old_category ? $item->old_category : '-' }}</td>
            @if($item->old_category)
                <?php
                $categoryCircles_users1 = $categoryCircles_users2 = $auth_circle_users = array();

                $categoryCircles = \App\CategoryCircles::where('category_id', '=', $item->old_category_id)->get();

                $userinprojects = \App\AccountProjects::select('rate', 'account_id')->where('project_id', '=', $item->project_id)
                    ->pluck('rate', 'account_id')->toArray();

                foreach ($categoryCircles as $categoryCircle) {
                    if ($categoryCircle->procedure_type == 2) {
                        array_push($categoryCircles_users1, $categoryCircle->circle_id);
                    }

                    if ($categoryCircle->procedure_type == 3) {
                        array_push($categoryCircles_users2, $categoryCircle->circle_id);
                    }
                }

                $user1 = \App\Circle::find($categoryCircles_users1[0]);
                $user2 = \App\Circle::find($categoryCircles_users2[0]);

                ?>
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$user1->name}}</td>
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$user2->name}}</td>
            @else
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">-</td>
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">-</td>
            @endif

            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->response_type}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">@if($item->required_respond) {{$item->required_respond}}@else {{'-'}} @endif</td>

            {{--       الردود والمتابعات     --}}
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->replay_status}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->response}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->form_responses_datee}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->user_required_respond_full_name}}</td>

            {{--      التغذية الراجعة:      --}}
            @if($item->solve && $item->solve == 2)
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;"> لم يتم التبليغ</td>
            @elseif($item->solve && $item->solve == 1)
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;"> تم التبليغ</td>
            @else
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;"> قيد التبليغ</td>
            @endif

            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->follow_reason_not}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->follow_datee}}</td>
            @if($item->evaluate == 1)
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;"> راضي بشكل كبير</td>
            @elseif($item->evaluate==2)
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;"> راضي بشكل متوسط</td>
            @elseif($item->evaluate == 3)
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;"> راضي بشكل ضعيف</td>
            @elseif($item->evaluate == 4)
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;"> غير راضي عن الرد</td>
            @else
                <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;"> - </td>
            @endif
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->form_follow_notes}}</td>

             {{--       متابعة معالجة الاقتراح/الشكوى في حال عدم رضا مقدمها عن الرد الذي تلقاه     --}}
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">{{$item->user_reprocessing_recommendations_full_name}}</td>
            <td style="padding: 10px;border: 1px solid black;border-collapse: collapse;">@if(!$item->follower_reprocessing == 1){{'لا'}}@else{{'نعم'}}@endif</td>

        </tr>
    @endforeach
    </tbody>
</table>
